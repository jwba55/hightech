<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="users">
	<select id = "total" resultType="Integer">
			select count(*) from users	
		</select>
		
		<select id="list" resultType="Users">
			select * from users
		</select>
		<select id="selectRegexDetail" parameterType="String" resultType="RegexDetail">
			select * from
		        RegexDetail rd
		    join Users u on rd.userId = u.userId
		    where u.username = #{username}
		    order by rd.regexId asc
		</select>
		
		<select id="selectNewRegex" parameterType="String" resultType="NewRegex">
			select * from
		        NewRegex nr
		    join Users u on nr.userId = u.userId
		    where u.username = #{username}
		    order by nr.newRegexId asc
		</select>
		
		<select id="selectUserId" resultType="Long">
			select MAX(userId) from Users
		</select>
			
		<select id="selectLastRegexId" resultType="Long">
			select MAX(regexId) from Regexdetail
		</select>
		
		<select id="selectLastNewRegexId" resultType="Long">
			select MAX(newRegexId) from NewRegex
		</select>
		
		<select id="getFirstNewRegexId" resultType="long" parameterType="String">
			select nr.newRegexId from NewRegex nr
		    join Users u on nr.userId = u.userId
		    where u.username = #{username}
		    order by nr.newRegexId asc
		    fetch first 1 rows only
		</select>
		
		<select id="items" resultType="Users">
			select * from users
			where userId=#{userId}
		</select>
		
		<select id="item" resultType="Users">
			select * from users
			where userId=#{userId}
		</select>
		
		<insert id="add">
			insert into users
			values (#{userId}, #{username}, #{password},#{nickname}, #{birthday}, #{phone}, #{gender}, #{profileImage}, #{agreeStatus}, #{signupDay}, #{roleId})
		</insert>
		
		<insert id="addRegex" parameterType="java.util.List">
		    INSERT ALL
		    <foreach collection="list" item="regexDetail">
		        INTO RegexDetail 
		        (regexId, regexInfo, regexLocation, userId)
		        VALUES (#{regexDetail.regexId}, #{regexDetail.regexInfo}, #{regexDetail.regexLocation}, #{regexDetail.userId})
		    </foreach>
		    SELECT * FROM dual
		</insert>
		
		<insert id="addNewRegex" parameterType="java.util.List">
		    INSERT ALL
		    <foreach collection="list" item="newRegex">
		        INTO NewRegex 
		        (newRegexId, newRegexInfo, newRegexLocation, userId)
		        VALUES (#{newRegex.newRegexId}, #{newRegex.newRegexInfo}, #{newRegex.newRegexLocation}, #{newRegex.userId})
		    </foreach>
		    SELECT * FROM dual
		</insert>
		
		<update id="update">
			update users
			set username=#{username}, password=#{password}, nickname=#{nickname}, birthday=#{birthday}, phone=#{phone}, gender=#{gender}, profileImage=#{profileImage}, agreeStatus=#{agreeStatus}, signupDay=#{signupDay}, roleId=#{roleId}
			where userId=#{userId}
		</update>
		
		<delete id="delete">
			delete from users
			where userId=#{userId}
		</delete>
		
		<select id="login" resultType="Users">
			select * from users
			where username=#{username} and password=#{password}
		</select>
</mapper>
